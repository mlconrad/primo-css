<!--
  This file should not change the layout of the page.
  i.e. do not include any elements unless they are
    display:none
    position:absolute
    position:fixed
-->
<style type="text/css">
  @import url(../uploaded_files/NOVANET_TEMPLATE/common.css);
</style>
<!-- uri.js from http://medialize.github.io/URI.js/ or https://github.com/medialize/URI.js -->
<script type="text/javascript" src="/primo_library/libweb/uploaded_files/NOVANET_TEMPLATE/uri.js"></script>
<!-- add an indicator on the page when we are in sandbox. -->
<div id="novanet-sandbox-indicator" style="display:none">
<header>SANDBOX SERVER</header>
<span class="info" style="display:none">
  This is a forum for experimenting with new settings for the Primo site.
  The production version of this page can be found here: <a class="live-link">Novanet Primo</a>
</span>
</div>
<script>
// <![CDATA[
  var novanet = novanet || {};
  if (!novanet.uri){
    novanet.uri = new URI();
  }
  if (novanet.uri.hostname().substr(0,12) == 'nova-primosb' || novanet.uri.hostname().indexOf('test.novanet.ca') > -1){
    var liveLink = novanet.uri.hostname(novanet.uri.hostname().replace('nova-primosb','novanet-primo').replace('test', ''));
    var div = $('#novanet-sandbox-indicator');
    div.find('.live-link').attr('href', liveLink);
    div.find('header').on('click', function(){ div.find('.info').toggle(); });
    div.show();
  }


//  add MaRC View to the Actions menu

  var novanet = novanet || {};
  novanet.marcWindows = novanet.marcWindows || {};
  novanet.openMarcView = function(id){
    var name = 'marcview'+id, winRef = novanet.marcWindows[name];
    
    if (winRef == null || winRef.closed){
      winRef = window.open(
        "http://www.novanet.ca/marc/"+id, //this is a full HTML page displaying a single MaRC record.
        name,
        "titlebar=1,resizable=1,scrollbars=1,status=0,menubar=0,toolbar=0,location=0"
      );
    }
    else{
      winRef.focus();
    }
  };

  $(document).ready(function(){
    //on open action menu
    $('#exlidResultsContainer').on('click', '.EXLTabHeaderButtonSendTo', function(evt){
      var $this = $(this),
          $thisLink = $this.children('a'),
          $thisList = $this.children('ol'),
          matches = $thisLink.attr('id').match(/NOVANET_ALEPH(\d{9})/),
          id = matches && matches[1];
      
      if (id && $thisList.find('li.marcview').length < 1){
        $thisList.append(
          $('<li>').addClass('marcview').append(
            $('<a>').attr({
              href: '#'
            }).on('click', function(evt){
              evt.preventDefault();
              novanet.openMarcView(id);
            }).html('MaRC View')
          )
        );
      }
    });
  });

// ]]>
</script>
